<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>木構築の調査</title>
    <link type="text/css" rel="stylesheet" href="file:///C:/Users/Kouichi/source/repos/wordring_cpp/docs/default.css">
  </head>
  <body><a href="../index.html"><img src="../../up.svg" alt=""></a> <br>
    <h1>木構築の調査</h1>
    <h2>変数の調査</h2>
    <h3><span style="color: #505050;"></span>アクティブ整形要素リスト</h3>
    <ul>
      <li>要素の属性を比較</li>
      <li>トークンから要素を作成する</li>
    </ul>
    <h3>要素の属性アクセス</h3>
    <ul>
      <li>metaタグのcharset属性</li>
      <ul>
        <li><a href="https://triple-underscore.github.io/HTML-parsing-ja.html#parsing-main-inhead">https://triple-underscore.github.io/HTML-parsing-ja.html#parsing-main-inhead</a></li>
      </ul>
    </ul>
    <p><br>
    </p>
    <h2>規格で不明な点</h2>
    <h3>挿入モードの調査</h3>
    <h4>記録</h4>
    <ul>
      <li>開始タグトークンを新規作成する場合がある（入力テキストに存在しなくても、DOMに挿入するから？）</li>
      <li>開始タグトークンを作成して現トークンとする</li>
      <ul>
        <li>&nbsp;"in body" insertion mode</li>
      </ul>
      <li>別のモードに切り替えてから、現トークンを再処理する場合がある。</li>
      <ul>
        <li>切り替えない処理は定義されている。</li>
      </ul>
      <li>開始タグ「image」のタグ名を「img」に変えて再処理</li>
      <ul>
        <li>"in body" insertion mode</li>
      </ul>
      <li>符号化を変更する場合がある。</li>
      <ul>
        <li>&nbsp;"in head" insertion mode</li>
      </ul>
      <li>パーサがdocument.write()、document.writeln()から呼び出されている場合の場合分けがある。</li>
      <ul>
        <li>&nbsp;"in head" insertion mode</li>
      </ul>
      <li>script要素固有のフラグを立てる</li>
      <ul>
        <li>&nbsp;"in head" insertion mode</li>
      </ul>
      <li>DOM木から要素を除去する場合がある</li>
      <ul>
        <li>&nbsp;"in body" insertion mode</li>
      </ul>
      <li>次のトークンを参照し、LFだった場合、それを無視する動作が必要。</li>
      <ul>
        <li>&nbsp;"in body" insertion mode</li>
      </ul>
      <li>スクリプトの処理</li>
      <ul>
        <li>パーサー内からパーサ内への再入が有るので、規格通りでは危険かもしれない</li>
        <li>&nbsp;"text" insertion mode</li>
      </ul>
      <li>&nbsp;変数pending table character tokens</li>
      <ul>
        <li>&nbsp;"in table" insertion mode</li>
      </ul>
      <li>&nbsp;"in table" insertion modeの処理を拝借</li>
      <ul>
        <li>小さな処理なので複製で良いかもしれない</li>
        <li>&nbsp;"in table text" insertion mode</li>
      </ul>
    </ul>
    <h4>挿入モードの追跡調査リスト</h4>
    <h5>The rules for parsing tokens in HTML content</h5>
    <ol>
      <li>&nbsp;"initial" insertion mode</li>
      <ul>
        <li><b>公開識別子判定表</b></li>
      </ul>
      <li>&nbsp;"before html" insertion mode</li>
      <li>&nbsp;"before head" insertion mode</li>
      <ul>
        <li>開始タグトークン「head」を<b><span style="color: #990000;">作成する</span></b></li>
      </ul>
      <li>&nbsp;"in head" insertion mode</li>
      <ul>
        <li>符号化を変更する</li>
        <li>document.write()、document.writeln()から呼び出されている場合の場合分け</li>
        <li>script要素固有のフラグを立てる</li>
      </ul>
      <li>&nbsp;"in head noscript" insertion mode</li>
      <li>&nbsp;"after head" insertion mode</li>
      <ul>
        <li>開始タグトークン「body」を<b><span style="color: #990000;">作成する</span></b></li>
      </ul>
      <li>&nbsp;"in body" insertion mode</li>
      <ul>
        <li>「stack of open
          elements」内の二個目の要素とは、「html」「body」とPUSHされる前提があるからと考えられる。</li>
        <li>DOM木から要素を除去する</li>
        <li>次のトークンを参照し、LFだった場合、そのLFを無視する動作が必要。（この一カ所のみ）</li>
        <li>開始タグトークン「br」を<b style="color: #990000;">作成して</b>現トークンとする</li>
        <ul>
          <li>終了タグ「/br」を開始タグ「br」として処理したいだけ？</li>
        </ul>
        <li>開始タグ「image」のタグ名を「img」に<b><span style="color: #990000;">変えて</span></b>再
          処理</li>
      </ul>
      <li>&nbsp;"text" insertion mode</li>
      <ul>
        <li>スクリプトの処理を含む</li>
      </ul>
      <li>&nbsp;"in table" insertion mode</li>
      <ul>
        <li>&nbsp;変数pending table character tokens</li>
        <li>開始タグトークン「colgroup」を<b><span style="color: #990000;">作成する</span></b></li>
        <li>開始タグトークン「tbody」を<b><span style="color: #990000;">作成する</span></b></li>
      </ul>
      <li>&nbsp;"in table text" insertion mode</li>
      <ul>
        <li>&nbsp;"in table" insertion modeの処理を拝借</li>
      </ul>
      <li>&nbsp;"in caption" insertion mode</li>
      <li>&nbsp;"in column group" insertion mode</li>
      <li>&nbsp;"in table body" insertion mode</li>
      <li>&nbsp;"in row" insertion mode</li>
      <li>&nbsp;"in cell" insertion mode</li>
      <li>&nbsp;"in select" insertion mode</li>
      <li>&nbsp;"in select in table" insertion mode</li>
      <li>&nbsp;"in template" insertion mode</li>
      <li>&nbsp;"after body" insertion mode</li>
      <li>&nbsp;"in frameset" insertion mode</li>
      <li>&nbsp;"after frameset" insertion mode</li>
      <li>&nbsp;"after after body" insertion mode</li>
      <li>&nbsp;"after after frameset" insertion mode</li>
    </ol>
    <h5>The rules for parsing tokens in foreign content</h5>
    <ul>
      <li><b>SVGタグ名変換表</b></li>
    </ul>
    <h3>12.2.4.2 The stack of open elements</h3>
    <h4>in a specific scope</h4>
    <h5>ターゲットとして指定されるもの</h5>
    <ul>
      <li>タグ名（タグ名、名前空間）</li>
      <li>トークンのタグ名と一致するHTML要素（タグ名、HTML名前空間）</li>
      <li>タグ名の集合</li>
      <li>要素</li>
    </ul>
    <h3>12.2.4.3 The list of active formatting elements</h3>
    <h4>整形要素のリストに挿入されるもの</h4>
    <ul>
      <li>要素とトークンのペア</li>
      <li>マーカ</li>
    </ul>
    <h4><a href="https://html.spec.whatwg.org/multipage/parsing.html#push-onto-the-list-of-active-formatting-elements">&nbsp;push
        onto the list of active formatting elements</a></h4>
    <p>then remove the earliest <b style="color: #ffcc33;">such element</b>
      from the list of active formatting elements.</p>
    <p>「そのような要素」という部分から、リストの先頭を削除するのではなく、マーカーがある場合は、マーカー以降にある同一シグネチャの要素のうち最も古いも
      の、あるいはマーカーが無い場合リスト全体内の同一シグネチャを持つ要素のうち最も古いものを削除すると考えられる。</p>
    <p>つまり、マーカーが有ればマーカからマーカ、無ければリスト全体において、3個以上同一シグネチャの要素を面倒見ないということだと思われる。</p>
    <p><br>
    </p>
    <ul>
    </ul>
  </body>
</html>
